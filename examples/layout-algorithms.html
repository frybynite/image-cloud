<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Cloud - Layout Algorithms Demo</title>
    <!-- Required: Image Cloud CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@frybynite/image-cloud@latest/dist/style.css">
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            padding: 20px;
            font-family: system-ui, -apple-system, sans-serif;
            background: #1a1a2e;
            color: #eee;
        }
        h1 {
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }
        .cloud-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            max-width: 1800px;
            margin: 0 auto;
        }
        .cloud-section {
            background: #16213e;
            border-radius: 12px;
            padding: 20px;
        }
        .cloud-section h2 {
            margin: 0 0 10px 0;
            font-size: 1.3rem;
            color: #7f5af0;
        }
        .cloud-section p {
            margin: 0 0 15px 0;
            color: #888;
            font-size: 0.9rem;
        }
        .cloud-section .image-cloud.fbn-ic-gallery {
            width: 100%;
            height: 400px;
            position: relative;
            background: #0f0f23;
            border-radius: 8px;
            overflow: hidden;
        }
        .controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .controls button {
            padding: 8px 16px;
            background: #7f5af0;
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-size: 0.85rem;
        }
        .controls button:hover {
            background: #6b46c1;
        }
        .controls select {
            padding: 8px 12px;
            background: #2d3748;
            border: 1px solid #4a5568;
            border-radius: 6px;
            color: white;
            font-size: 0.85rem;
        }
    </style>
    <script type="importmap">
    {
        "imports": {
            "@frybynite/image-cloud": "https://cdn.jsdelivr.net/npm/@frybynite/image-cloud@latest/dist/image-cloud.js",
            "@frybynite/image-cloud/loaders/static": "https://cdn.jsdelivr.net/npm/@frybynite/image-cloud@latest/dist/loaders/static.js",
            "@frybynite/image-cloud/loaders/google-drive": "https://cdn.jsdelivr.net/npm/@frybynite/image-cloud@latest/dist/loaders/google-drive.js",
            "@frybynite/image-cloud/loaders/composite": "https://cdn.jsdelivr.net/npm/@frybynite/image-cloud@latest/dist/loaders/composite.js",
            "@frybynite/image-cloud/loaders/all": "https://cdn.jsdelivr.net/npm/@frybynite/image-cloud@latest/dist/loaders/all.js"
        }
    }
    </script>
</head>
<body>
    <h1>Layout Algorithms Demo</h1>
    <p class="subtitle">Explore different image placement algorithms</p>

    <div class="cloud-grid">
        <!-- Grid Layout -->
        <div class="cloud-section">
            <h2>Grid Layout</h2>
            <p>Clean rows and columns with optional stagger and jitter for organic feel</p>
            <div id="cloud-grid" class="image-cloud"></div>
            <div class="controls">
                <select id="grid-stagger">
                    <option value="none">No Stagger</option>
                    <option value="row">Row Stagger</option>
                    <option value="column">Column Stagger</option>
                </select>
                <select id="grid-jitter">
                    <option value="0">No Jitter</option>
                    <option value="0.3">Light Jitter</option>
                    <option value="0.6">Medium Jitter</option>
                    <option value="1">Heavy Jitter</option>
                </select>
                <button id="grid-refresh">Try it</button>
            </div>
        </div>

        <!-- Spiral Layout -->
        <div class="cloud-section">
            <h2>Spiral Layout</h2>
            <p>Images arranged along a spiral path - golden, archimedean, or logarithmic</p>
            <div id="cloud-spiral" class="image-cloud"></div>
            <div class="controls">
                <select id="spiral-type">
                    <option value="golden">Golden Spiral</option>
                    <option value="archimedean">Archimedean</option>
                    <option value="logarithmic">Logarithmic</option>
                </select>
                <select id="spiral-direction">
                    <option value="counterclockwise">Counter-clockwise</option>
                    <option value="clockwise">Clockwise</option>
                </select>
                <button id="spiral-refresh">Try it</button>
            </div>
        </div>

        <!-- Cluster Layout -->
        <div class="cloud-section">
            <h2>Cluster Layout</h2>
            <p>Organic groupings like photos scattered on a table</p>
            <div id="cloud-cluster" class="image-cloud"></div>
            <div class="controls">
                <select id="cluster-count">
                    <option value="auto">Auto Clusters</option>
                    <option value="2">2 Clusters</option>
                    <option value="3">3 Clusters</option>
                    <option value="5">5 Clusters</option>
                </select>
                <select id="cluster-distribution">
                    <option value="gaussian">Gaussian</option>
                    <option value="uniform">Uniform</option>
                </select>
                <button id="cluster-refresh">Try it</button>
            </div>
        </div>

        <!-- Wave Layout -->
        <div class="cloud-section">
            <h2>Wave Layout</h2>
            <p>Images positioned along flowing sine wave curves</p>
            <div id="cloud-wave" class="image-cloud"></div>
            <div class="controls">
                <select id="wave-rows">
                    <option value="2">2 Rows</option>
                    <option value="3" selected>3 Rows</option>
                    <option value="4">4 Rows</option>
                </select>
                <select id="wave-sync">
                    <option value="offset">Offset Waves</option>
                    <option value="synchronized">Synchronized</option>
                    <option value="alternating">Alternating</option>
                </select>
                <select id="wave-rotation">
                    <option value="tangent">Follow Wave</option>
                    <option value="none" selected>Stay Upright</option>
                </select>
                <button id="wave-refresh">Try it</button>
            </div>
        </div>

        <!-- Radial Layout (existing) -->
        <div class="cloud-section">
            <h2>Radial Layout</h2>
            <p>Concentric rings emanating from center (existing algorithm)</p>
            <div id="cloud-radial" class="image-cloud"></div>
        </div>

        <!-- Random Layout (existing) -->
        <div class="cloud-section">
            <h2>Random Layout</h2>
            <p>Randomly scattered images (existing algorithm)</p>
            <div id="cloud-random" class="image-cloud"></div>
        </div>
    </div>

    <script type="module">
        import { ImageCloud } from '@frybynite/image-cloud';

        // Sample images from Pexels
        const sampleImages = [
            'https://images.pexels.com/photos/1261728/pexels-photo-1261728.jpeg?auto=compress&w=600',
            'https://images.pexels.com/photos/3225517/pexels-photo-3225517.jpeg?auto=compress&w=600',
            'https://images.pexels.com/photos/1402787/pexels-photo-1402787.jpeg?auto=compress&w=600',
            'https://images.pexels.com/photos/1266810/pexels-photo-1266810.jpeg?auto=compress&w=600',
            'https://images.pexels.com/photos/417074/pexels-photo-417074.jpeg?auto=compress&w=600',
            'https://images.pexels.com/photos/1287460/pexels-photo-1287460.jpeg?auto=compress&w=600',
            'https://images.pexels.com/photos/1054218/pexels-photo-1054218.jpeg?auto=compress&w=600',
            'https://images.pexels.com/photos/1450360/pexels-photo-1450360.jpeg?auto=compress&w=600',
            'https://images.pexels.com/photos/2662116/pexels-photo-2662116.jpeg?auto=compress&w=600',
            'https://images.pexels.com/photos/1559825/pexels-photo-1559825.jpeg?auto=compress&w=600',
            'https://images.pexels.com/photos/3408744/pexels-photo-3408744.jpeg?auto=compress&w=600',
            'https://images.pexels.com/photos/1183099/pexels-photo-1183099.jpeg?auto=compress&w=600'
        ];

        const loaderConfig = {
            static: {
                sources: [{ urls: sampleImages }],
                validationMethod: 'none'
            }
        };

        // Each cloud targets a different container div by id.
        // The 'layout' config controls the placement algorithm and its parameters.

        // Grid: arranges images in rows/columns with optional stagger and jitter
        const gridCloud = new ImageCloud({
            container: 'cloud-grid',
            loaders: [loaderConfig],
            layout: {
                algorithm: 'grid',
                sizing: { base: 100 },
                grid: {
                    columns: 'auto',     // auto-calculate column count
                    rows: 'auto',        // auto-calculate row count
                    stagger: 'none',     // 'none', 'row', or 'column'
                    jitter: 0,           // random offset (0-1)
                    overlap: 0.2,        // allowed overlap between images (0-1)
                    gap: 10              // gap between cells in pixels
                }
            }
        });

        // Spiral: images along a spiral path from center outward
        const spiralCloud = new ImageCloud({
            container: 'cloud-spiral',
            loaders: [loaderConfig],
            layout: {
                algorithm: 'spiral',
                sizing: { base: 80 },
                spiral: {
                    spiralType: 'golden',         // 'golden', 'archimedean', or 'logarithmic'
                    direction: 'counterclockwise', // 'clockwise' or 'counterclockwise'
                    tightness: 1.0,                // how tightly wound the spiral is
                    scaleDecay: 0.3                // images shrink as they move outward (0-1)
                }
            }
        });

        // Cluster: organic groupings, like photos scattered on a table
        const clusterCloud = new ImageCloud({
            container: 'cloud-cluster',
            loaders: [loaderConfig],
            layout: {
                algorithm: 'cluster',
                sizing: { base: 90 },
                cluster: {
                    clusterCount: 'auto',      // number of groups ('auto' or a number)
                    clusterSpread: 120,         // how spread out images are within a cluster
                    clusterSpacing: 180,        // distance between cluster centers
                    overlap: 0.4,               // allowed image overlap (0-1)
                    distribution: 'gaussian'    // 'gaussian' or 'uniform'
                }
            }
        });

        // Wave: images along flowing sine wave curves
        const waveCloud = new ImageCloud({
            container: 'cloud-wave',
            loaders: [loaderConfig],
            layout: {
                algorithm: 'wave',
                sizing: { base: 100 },
                wave: {
                    rows: 3,                      // number of wave rows
                    amplitude: 80,                 // wave height in pixels
                    frequency: 2,                  // number of wave cycles
                    synchronization: 'offset'      // 'offset', 'synchronized', or 'alternating'
                }
            },
            image: {
                rotation: { mode: 'none' }  // 'tangent' to follow wave, 'none' to stay upright
            }
        });

        // Radial Cloud (existing)
        const radialCloud = new ImageCloud({
            container: 'cloud-radial',
            loaders: [loaderConfig],
            layout: {
                algorithm: 'radial',
                sizing: { base: 100 }
            }
        });

        // Random Cloud (existing)
        const randomCloud = new ImageCloud({
            container: 'cloud-random',
            loaders: [loaderConfig],
            layout: {
                algorithm: 'random',
                sizing: { base: 120 }
            }
        });

        // Store cloud instances for refresh
        let clouds = {
            grid: gridCloud,
            spiral: spiralCloud,
            cluster: clusterCloud,
            wave: waveCloud,
            radial: radialCloud,
            random: randomCloud
        };

        // Initialize all clouds
        Promise.all([
            gridCloud.init(),
            spiralCloud.init(),
            clusterCloud.init(),
            waveCloud.init(),
            radialCloud.init(),
            randomCloud.init()
        ]).catch(error => {
            console.error('Cloud initialization failed:', error);
        });

        // Helper to recreate a cloud with new config
        async function refreshCloud(containerId, config) {
            // Clear the container
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            // Create new cloud
            const cloud = new ImageCloud({
                container: containerId,
                loaders: [loaderConfig],
                layout: config
            });

            await cloud.init();
            return cloud;
        }

        // Grid refresh handler
        document.getElementById('grid-refresh').addEventListener('click', async () => {
            const stagger = document.getElementById('grid-stagger').value;
            const jitter = parseFloat(document.getElementById('grid-jitter').value);

            clouds.grid = await refreshCloud('cloud-grid', {
                algorithm: 'grid',
                sizing: { base: 100 },
                grid: {
                    columns: 'auto',
                    rows: 'auto',
                    stagger: stagger,
                    jitter: jitter,
                    overlap: 0.2,
                    gap: 10
                }
            });
        });

        // Spiral refresh handler
        document.getElementById('spiral-refresh').addEventListener('click', async () => {
            const spiralType = document.getElementById('spiral-type').value;
            const direction = document.getElementById('spiral-direction').value;

            clouds.spiral = await refreshCloud('cloud-spiral', {
                algorithm: 'spiral',
                sizing: { base: 80 },
                spiral: {
                    spiralType: spiralType,
                    direction: direction,
                    tightness: 1.0,
                    scaleDecay: 0.3
                }
            });
        });

        // Cluster refresh handler
        document.getElementById('cluster-refresh').addEventListener('click', async () => {
            const countValue = document.getElementById('cluster-count').value;
            const clusterCount = countValue === 'auto' ? 'auto' : parseInt(countValue);
            const distribution = document.getElementById('cluster-distribution').value;

            clouds.cluster = await refreshCloud('cloud-cluster', {
                algorithm: 'cluster',
                sizing: { base: 90 },
                cluster: {
                    clusterCount: clusterCount,
                    clusterSpread: 120,
                    clusterSpacing: 180,
                    overlap: 0.4,
                    distribution: distribution
                }
            });
        });

        // Wave refresh handler
        document.getElementById('wave-refresh').addEventListener('click', async () => {
            const rows = parseInt(document.getElementById('wave-rows').value);
            const synchronization = document.getElementById('wave-sync').value;
            const rotationMode = document.getElementById('wave-rotation').value;

            // Clear the container
            const container = document.getElementById('cloud-wave');
            container.innerHTML = '';

            // Create new cloud with image rotation config
            const cloud = new ImageCloud({
                container: 'cloud-wave',
                loaders: [loaderConfig],
                layout: {
                    algorithm: 'wave',
                    sizing: { base: 100 },
                    wave: {
                        rows: rows,
                        amplitude: 80,
                        frequency: 2,
                        synchronization: synchronization
                    }
                },
                image: {
                    rotation: { mode: rotationMode }
                }
            });

            await cloud.init();
            clouds.wave = cloud;
        });
    </script>
    <script src="view-source-popup.js"></script>
</body>
</html>
